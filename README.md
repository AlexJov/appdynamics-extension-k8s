# appdynamics-extension-k8s
Tool to easily deploy an AppDynamics extension to K8s

## How to use
1. Download your desired AppDynamics extensions from https://www.appdynamics.com/community/exchange/ . It should be a zip format file. ( Copy the zip url link and downlaod with wget or curl is the easy way )
2. Place the downloaded zip file under `extensions` directory.
3. Run build.sh with the tag name of the extension docker image to create.
`./build.sh -t <your registry>/<your repo>/appdymamics-extensions:latest`
4. Push the created docker image to your container registry.
`docker push <your registry>/<your repo>/appdymamics-extensions:latest`
5. Edit deploy/ma-config.yaml with your AppDynamics controller properties.
6. Create secret for controller access key.
`kubectl -n appdynamics create secret generic appd-secret --from-literal=appd-key="<Your access key>"`
7. Edit deploy/ma-extension-config.yaml for the configuration of your extension.
8. Lastly, deploy all the yaml file under deploy directory.
`kubectl create -f deploy/`
9. Login to AppDynamics controller. Select Servers from top menu. Select Metric Browser from left menu. In Metric Browser , navigate tree to Application Infrastructure Performance|Root|Individual Nodes|machine-agent-extension|Custom Metrics. The metrics should be showing up under this tree node.
## When modifying extension configurations 
1. Edit the deploy/ma-extension-config.yaml. This file is generated by the build.sh script.
2. Delete the current deployment.
`kubectl delete -f deploy/`
3. Re-create the deployment.
`kubectl create -f deploy/`


## When adding extensions 
1. Add the extension zip file to `extensions` directory
2. Run build.sh with the tag name of the extension docker image to create.
`./build.sh -t <your registry>/<your repo>/appdymamics-extensions:latest`
3. A fresh deploy/ma-extension-config.yaml is created and the previous ma-extension-config.yaml is backed up with date suffix. Manually re-apply the previous configurations to the new file.
4. Delete the current deployment.
`kubectl delete -f deploy/`
5. Re-create the deployment.
`kubectl create -f deploy/`
